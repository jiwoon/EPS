@model EPS.ViewModels.Document.vCHECKLIST_Manage
@{
    ViewBag.Title = "AddItem";
}

<h2>@Html.Raw(TempData["Title"].ToString())</h2>
<div ng-app="app">
    @Html.Hidden("CheckID", TempData["CheckID"])
    <div ng-controller="vCheckListController as ctrl">
        <!-- main form -->
        <form name="vCheckListsForm" ng-submit="ctrl.savevCheckLists()" novalidate>
            <input type="button" value="新增" ng-click="ctrl.addvCheckList()" class="btn btn-default" />
            <input type="submit" value="儲存" ng-disabled="vCheckListsForm.$invalid" class="btn btn-default" />
            <br><br>
            <!-- sub form - repeat order -->
            <ng-form ng-repeat="vCheckList in ctrl.vCheckLists" name="subForm">
                <!-- group box -->
                <fieldset class="well the-fieldset">
                    <legend class="the-legend">檢核項目</legend>
                    <table class="table">
                        <tr>
                            <th>主題</th>
                            <th>敘述</th>
                            <th>開始時間</th>
                            <th>結束時間</th>
                            <th>班別</th>
                            <th>類別</th>
                            <th>類型</th>
                            <th>持續顯示</th>
                            <th>負責人</th>
                            <th>顯示順序</th>
                        </tr>
                        <tr>
                            <td>
                                <input ng-model="vCheckList.ListName" required class="form-control">
                            </td>
                            <td>
                                <input ng-model="vCheckList.Definition" required class="form-control">
                            </td>
                            <td>
                                <input ng-model="vCheckList.StartTime" required class="form-control">
                            </td>
                            <td>
                                <input ng-model="vCheckList.EndTime" required class="form-control">
                            </td>
                            <td>
                                @Html.Hidden("ShiftID", "")
                                <select ng-model="ShiftIDs" ng-options="m.id as m.ShiftName for m in vCheckList.ShiftIDList" id="ShiftIDs">
                                    <option value="" selected="selected">-- 請選擇 --</option>
                                </select>
                            </td>
                            <td>
                                @Html.Hidden("ClassID", "")
                                <select ng-model="ClassIDs" ng-options="m.id as m.ClassName for m in vCheckList.ClassIDList" id="ClassIDs">
                                    <option value="" selected="selected">-- 請選擇 --</option>
                                </select>
                            </td>
                            <td>
                                <input ng-model="vCheckList.CheckType" required class="form-control">
                            </td>
                            <td>
                                <input type="checkbox" ng-model="vCheckList.AlwaysShow" required class="form-control">
                            </td>
                            <td>
                                @Html.Hidden("ChargerID", "")
                                <select ng-model="ChargerIDs" ng-options="m.id as m.ChargerName for m in vCheckList.ChargerList" id="ChargerIDs">
                                    <option value="" selected="selected">-- 請選擇 --</option>
                                </select>
                            </td>
                            <td>
                                <input ng-model="vCheckList.ShowOrder" required class="form-control" id="ShowOrder">
                            </td>
                        </tr>
                        <tr>
                            <td colspan="11">
                                <input type="button" value="移除"
                                       ng-click="ctrl.removevCheckList($index)" class="btn btn-default" />
                            </td>
                        </tr>
                    </table>
                </fieldset>
            </ng-form>
        </form>
        <br>
    </div>
</div>
<!-- 定義共用的錯誤訊息(可抽出為獨立檔案) -->
<script type="text/ng-template" id="commonMessage">
    <span ng-message="required" class="text-danger field-validation-error">Required</span>
</script>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/angularApp")
}

@section AddItemScript{
    <script>
        @*var model=@Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(this.Model));
        augular.module('app').value("viewModel",model);*@

        $(function () {
            $("#ShiftIDs").change(function () {
                var val = $("#ShiftIDs :selected").val();
                var splits = val.split(":");
                $("#ShiftID").val(splits[1]);
                alert(splits[1]);
            });

            $("#ClassIDs").change(function () {
                var val = $("#ClassIDs :selected").val();
                var splits = val.split(":");
                $("#ClassID").val(splits[1]);
                alert(splits[1]);
            });

            $("#ChargerIDs").change(function () {
                var val = $("#ChargerIDs :selected").val();
                var splits = val.split(":");
                $("#ChargerID").val(splits[1]);
                alert(splits[1]);
            });

            @*$("#CheckID").change(function () {
                var val = $("#CheckID :selected").val();
                var splits = val.split(":");
                $.ajax({
                    url: "@Url.Content("~/Document/getShowOrder")",
                    data: 'CheckID=' + splits[1],
                    type: "Get",
                    dataType: 'text',

                    success: function (data) {
                        $("#ShowOrder").val(data);
                    },

                    error: function (xhr, ajaxOptions, thrownError) {
                        alert(xhr.status);
                        alert(thrownError);
                    }
                });
            })*@
        });

    </script>
}

